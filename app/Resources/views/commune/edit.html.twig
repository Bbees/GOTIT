{% extends 'edit.html.twig' %}

{# EDIT : COMMUNE #}

{% block body %}
    {{ parent() }}                  
{% endblock %}


{% block scripts %}
{{ parent() }}
{% if exception_message is defined %} <script type="text/javascript"> alert("{{exception_message|raw}}"); </script> {% endif %}

<script type="text/javascript">  

    $(document).ready(function(){
        // MAJ du codeStation, nomStation
        maj($('#bbees_e3sbundle_commune_codeCommune'));
        maj($('#bbees_e3sbundle_commune_nomCommune')); 
        maj($('#bbees_e3sbundle_commune_nomRegion')); 
        
        $('#bbees_e3sbundle_commune_codeCommune').attr("disabled", true);
        $('#bbees_e3sbundle_commune_nomCommune').keyup(function (e) {
            var nomCommune = $(this).val().toUpperCase().replace(/^\s+|\s+$/gm,'_');
            $(this).val(nomCommune);
            var nomPays = $('#bbees_e3sbundle_commune_paysFk option:selected').text();
            var nomRegion = $('#bbees_e3sbundle_commune_nomRegion').val();
            $('#bbees_e3sbundle_commune_codeCommune').val(nomCommune+'|'+nomRegion+'|'+nomPays);
        })
        $('#bbees_e3sbundle_commune_nomRegion').keyup(function (e) {
            var nomRegion = $(this).val().toUpperCase().replace(/^\s+|\s+$/gm,'_');
            $(this).val(nomRegion);
            var nomPays = $('#bbees_e3sbundle_commune_paysFk option:selected').text();
            var nomCommune = $('#bbees_e3sbundle_commune_nomCommune').val();
            $('#bbees_e3sbundle_commune_codeCommune').val(nomCommune+'|'+nomRegion+'|'+nomPays);
        })
        $('#bbees_e3sbundle_commune_paysFk').change(function (e) {  
            var nomPays = $('#bbees_e3sbundle_commune_paysFk option:selected').text();
            var nomRegion = $('#bbees_e3sbundle_commune_nomRegion').val();
            var nomCommune = $('#bbees_e3sbundle_commune_nomCommune').val();
            $('#bbees_e3sbundle_commune_codeCommune').val(nomCommune+'|'+nomRegion+'|'+nomPays);
        })
        // 3) Actions après la création d'une nouvelle Commune 
        $(document).on('submit','form[name="bbees_e3sbundle_commune"]',function(ev){
            $('#bbees_e3sbundle_commune_codeCommune').attr("disabled", false);             
	}); 
          
    });
 </script>
{% endblock %}
